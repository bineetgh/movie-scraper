{% extends "admin/base.html" %}
{% set active_page = 'dashboard' %}

{% block title %}Edit {{ movie.title }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Edit Movie</h1>
    <p><a href="/admin/dashboard" style="color: var(--primary);">&larr; Back to Movies</a></p>
</div>

{% if request.query_params.get('success') %}
<div class="alert alert-success">Movie updated successfully!</div>
{% endif %}

{% if request.query_params.get('error') %}
<div class="alert alert-error">Failed to update movie. Please try again.</div>
{% endif %}

<div style="display: grid; grid-template-columns: 300px 1fr; gap: 30px;">
    <!-- Movie Poster -->
    <div class="card" style="text-align: center;">
        <img src="{{ movie.poster_url or movie.tmdb_poster_url or '/static/placeholder.png' }}"
             alt="{{ movie.title }}"
             style="width: 100%; max-width: 250px; border-radius: 8px; margin-bottom: 15px;"
             onerror="this.src='/static/placeholder.png'">
        <p style="color: var(--text-muted); font-size: 0.85rem;">
            Slug: <code>{{ movie.slug }}</code>
        </p>
        <a href="/movie/{{ movie.slug }}" target="_blank" class="btn btn-secondary" style="margin-top: 10px;">
            View on Site
        </a>
    </div>

    <!-- Edit Form -->
    <div class="card">
        <form action="/admin/movie/{{ movie.slug }}" method="post">
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" name="title" class="form-control" value="{{ movie.title }}" required>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="year">Year</label>
                    <input type="number" id="year" name="year" class="form-control" value="{{ movie.year or '' }}" min="1900" max="2030">
                </div>

                <div class="form-group">
                    <label for="rating">IMDb Rating</label>
                    <input type="number" id="rating" name="rating" class="form-control" value="{{ movie.rating or '' }}" min="0" max="10" step="0.1">
                </div>
            </div>

            <div class="form-group">
                <label for="director">Director</label>
                <input type="text" id="director" name="director" class="form-control" value="{{ movie.director or '' }}">
            </div>

            <div class="form-group">
                <label for="genres">Genres (comma-separated)</label>
                <input type="text" id="genres" name="genres" class="form-control" value="{{ movie.genres | join(', ') }}">
            </div>

            <div class="form-group">
                <label for="synopsis">Synopsis</label>
                <textarea id="synopsis" name="synopsis" class="form-control" rows="4">{{ movie.synopsis or '' }}</textarea>
            </div>

            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <a href="/admin/dashboard" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<!-- Movie Details (Read-only) -->
<div class="card" style="margin-top: 20px;">
    <h3 style="margin-bottom: 15px;">Additional Info (Read-only)</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
        <div>
            <label style="color: var(--text-muted); font-size: 0.85rem;">Cast</label>
            <p>{{ movie.cast[:5] | join(', ') or 'N/A' }}</p>
        </div>
        <div>
            <label style="color: var(--text-muted); font-size: 0.85rem;">Runtime</label>
            <p>{{ movie.runtime_minutes or 'N/A' }} minutes</p>
        </div>
        <div>
            <label style="color: var(--text-muted); font-size: 0.85rem;">TMDB ID</label>
            <p>{{ movie.tmdb_id or 'N/A' }}</p>
        </div>
        <div>
            <label style="color: var(--text-muted); font-size: 0.85rem;">IMDB ID</label>
            <p>{{ movie.imdb_id or 'N/A' }}</p>
        </div>
        <div>
            <label style="color: var(--text-muted); font-size: 0.85rem;">Streaming Services</label>
            <p>{{ movie.streaming_services | join(', ') or 'N/A' }}</p>
        </div>
        <div>
            <label style="color: var(--text-muted); font-size: 0.85rem;">Availability</label>
            <p>
                {% if movie.is_free %}Free{% endif %}
                {% if movie.has_subscription %}Subscription{% endif %}
                {% if movie.is_rentable %}Rent{% endif %}
                {% if movie.is_buyable %}Buy{% endif %}
            </p>
        </div>
    </div>
</div>
{% endblock %}
